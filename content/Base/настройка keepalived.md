202204131649
***
*инструкция:*
1. [Как настроить плавающий IP используя keepalived](https://www.servers.ru/knowledge/linux-administration/how-to-setup-floating-ip-using-keepalived)
***
## Предварительные требования
### Выделенные серверы
...
### L2-сегмент
...
### Создание L2-сегмента и аренда IP-алиаса
...
## Keepalived
Это программа с исходным кодом, которая поддерживает балансировку нагрузки и высокую доступность. 
Это программное обеспечение маршрутизации и обеспечивает 2 типа балансировки нагрузки:
- 4 - транспортный ур.
- 7 - прикладной ур.
Keepalived может выполнять функции:
- Проверка работопособности (работают сервера или нет)
- Реализует 3-ур для балансировки нагрузки и отказоустойчивости

Keepalived использует VIP (виртуальный IP-адрес) как плавающий IP между master и backup системой и исп. для переключения между ними.
Если главный балансировщик нагрузки выключается, то резервный используется для пересылки веб-запроса. 
### Схема работы keepalived
[Отказоустойчивый кластер для балансировки нагрузки](https://www.netangels.ru/support/overview/failover-cluster/)
![[cluster.gif]]
### Требования к настройке подсистемы балансировки нагрузки
[сайт:](https://andreyex.ru/centos-7/balansirovka-nagruzki-s-haproxy-nginx-i-keepalived-v-linux-centos/)
В наличии:
- 2 сервера CentOS7

### Настройка keepalived
1. Установить и включить демон keepalived на каждом сервере:
`yum install keepalived`
`systemctl enable keepalived`

В нашей конфигурации 2 сервера: master и backup.
Плавающий IP-адрес назначается master.
Задача сервера backup, взять на себя плавающий IP-адрес и нагрузку сервера master в случае сбоя и наоборот.

Нет необходимости настраивать IP-адрес где то, кроме файла конфигурации keepalived.
Keepalived сам назначит IP-адрес нужному сетевому интерфейсу.

2. Конфигурация master
`/etc/keepalived/keepalived.conf`
выглядит: