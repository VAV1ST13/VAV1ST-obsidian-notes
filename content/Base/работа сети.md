202207210946
***
[[The Metaverse And How It Will Revolutionize Everything]]
***
ВАРИАНТЫ МЫСЛЕННОГО ЭКСПЕРИМЕНТА “ЕСЛИ в лесу падает дерево, а поблизости нет никого, кто мог бы его услышать, издает ли оно звук?” можно проследить на сотни лет назад. Упражнение продолжается отчасти потому, что это весело, и это весело, потому что оно зависит от важных технических деталей и философских идей.

Субъективный идеалист Джордж Беркли, которому часто приписывают вышеупомянутый вопрос, утверждал, что “быть - значит быть воспринятым”. Дерево — стоящее, падающее или упавшее — существует, если кто-то или что-то воспринимает его. Другие утверждают, что то, что мы подразумеваем под “звуком”, - это просто вибрации, которые распространяются через материю, и что они существуют независимо от того, воспринимаются они наблюдателем или нет. Или, может быть, звук — это ощущение, испытываемое мозгом, когда эти вибрации взаимодействуют с нервными окончаниями, а если нет нервов для взаимодействия с вибрирующими частицами, звука быть не может. С другой стороны, на протяжении десятилетий люди могли создавать физическое оборудование, способное интерпретировать вибрации как звук, тем самым позволяя слышать звук через искусственного наблюдателя. Но считается ли это? Между тем, сообщество квантовой механики сегодня в значительной степени соглашается с тем, что без наблюдателя существование в лучшем случае является гипотезой, которую нельзя доказать или опровергнуть — все, что можно сказать, это то, что дерево может существовать. (Альберт Эйнштейн, который сыграл важную роль в создании теории квантовой механики, не согласился с этой точкой зрения).

Во второй части я объясняю, что потребуется для создания и развития Метавселенной, начиная с сетевых и вычислительных возможностей, а затем переходя к игровым движкам и платформам, которые управляют ее многочисленными виртуальными мирами, стандартам, которые необходимы для их объединения, устройствам, через которые к ним осуществляется доступ, и платежные системы, лежащие в основе их экономики. Во всех этих многочисленных объяснениях я хочу, чтобы вы не забывали о дереве Беркли.

Почему? Потому что даже если Метавселенная будет “полностью реализована”, на самом деле она не будет существовать. Это, наряду с каждым из его деревьев, их многочисленными листьями и лесами, в которых они расположены, будет просто данными, хранящимися в кажущейся бесконечной сети серверов. Хотя можно утверждать, что до тех пор, пока существуют эти данные, Метавселенная и ее содержимое тоже существуют, существует множество различных шагов и технологий, необходимых для того, чтобы они существовали для кого угодно, кроме базы данных. Кроме того, каждая часть “стека Метавселенной” предоставляет компании рычаги влияния и сообщает, что возможно, а что невозможно для другой компании. Например, вы узнаете, что сегодня не более нескольких десятков человек могут даже наблюдать падение дерева с высокой точностью. И охватить больше пользователей? Что ж, виртуальный мир нужно будет дублировать — другими словами, чтобы многие люди услышали, как падает одно дерево, должно упасть много деревьев. (Попробуй это, Беркли!) Или, возможно, его наблюдатели поставлены на временную задержку, поэтому также не могут повлиять на падение или доказать его корреляцию. Другой метод заключается в упрощении коры дерева до бесцветного однородного коричневого цвета, а звук ее падения превращается в обычный глухой стук.

Чтобы разобраться в этих ограничениях и их последствиях, я хочу начать с реального примера: виртуальный мир, который я считаю наиболее технически впечатляющим на сегодняшний день. Нет, это не Роблокс и не Фортнайт. На самом деле, этот виртуальный мир, скорее всего, охватит меньше людей за свою жизнь, чем каждое из этих названий за один день. Это даже несправедливо называть игрой, как и многие виртуальные миры, которые мы рассматривали до сих пор. Вместо этого он предназначен для точного воспроизведения опыта, который многие считают неприятным, скучным или пугающим: путешествия на самолете.

### Bandwidth (Пропускная способность)

Первый симулятор полета был выпущен в 1979 году и быстро завоевал небольшую аудиторию. Три года спустя (но все еще за два десятилетия до выхода первой Xbox) Microsoft приобрела лицензию на название, выпустив еще десять частей к 2006 году. В 2012 году Книга рекордов Гиннесса назвала Flight Simulator самой продолжительной франшизой видеоигр, хотя большинству геймеров она оставалась неизвестной. Потребовалось время, пока 12-я часть, выпущенная в 2020 году, не проникла в общественное сознание Microsoft Flight Simulator (MSFS). Журнал Time назвал ее одной из лучших игр года. “Нью-Йорк Таймс” заявила, что MSFS обеспечивает “новый способ понимания цифрового мира”, предоставляя представление, "которое более реально, чем то, которое мы можем видеть снаружи [и] картину, которая освещает наше понимание реальности"*1*.

Теоретически MSFS - это то, что многие люди считают игрой. Через несколько секунд после открытия приложения вам будет напомнено, что его разработала и опубликовала студия Microsoft Xbox Game Studios. Однако цель MSFS не в том, чтобы победить, убить, выстрелить, победить, победить или забить другому игроку или конкуренту на основе искусственного интеллекта. Цель состоит в том, чтобы управлять виртуальным самолетом — процесс, который включает в себя большую часть той же работы, что и полет на реальном самолете. Игроки будут связываться с управлением воздушным движением и своими вторыми пилотами, ждать разрешения на взлет, устанавливать высотомер и закрылки, проверять запасы топлива и смеси, отпускать тормоз, медленно нажимать на дроссельную заслонку и так далее, прежде чем следовать выбранной или назначенной траектории полета, управляя конфликтующими маршрутами и приспосабливаясь к траектории полета других виртуальных самолетов.

Каждая модель серии MSFS предлагала такую функциональность, но издание 2020 года является экстраординарным — это самая реалистичная и обширная симуляция потребительского уровня в истории. Его карта занимает более 500 000 000 квадратных километров — точно так же, как “настоящая” планета Земля — и включает в себя два триллиона уникальных деревьев (не два триллиона скопированных и вставленных деревьев или два триллиона деревьев, состоящих из нескольких десятков разновидностей), 1,5 миллиарда зданий и почти каждую дорогу, гору, город., и аэропорт по всему миру.*2* Все выглядит как ”настоящее“, потому что виртуальный мир MSFS основан на высококачественных сканированиях и изображениях "реального”.

Репродукции и рендеры Microsoft Flight Simulator не идеальны, но они все равно потрясающие. “Игроки” могут пролететь мимо собственного дома и заметить свой почтовый ящик или качели на колесах во дворе. Даже когда “игра” должна воспроизводить закат, который отражается в заливе и который снова преломляется крыльями самолета, может быть трудно отличить скриншот из MSFS от реальной фотографии.

Чтобы осуществить это, “виртуальный мир” MSFS имеет размер почти 2,5 петабайта, или 2 500 000 гигабайт, что примерно в 1000 раз больше, чем у Fortnite. Потребительское устройство (или большинство корпоративных устройств) не может хранить такой объем данных. Максимальная емкость большинства консолей и ПК составляет 1000 гигабайт, в то время как самый большой сетевой накопитель потребительского класса (NAS) составляет 20 000 гигабайт и продается только за 750 долларов. Даже физическое пространство, необходимое для хранения 2,5 петабайт, непрактично.

Но даже если потребитель может позволить себе такой жесткий диск и иметь достаточно места для его размещения, MSFS - это оперативный сервис. Он обновляется, чтобы отражать реальную погоду (включая точную скорость и направление ветра, температуру, влажность, дождь и освещенность), воздушное движение и другие географические изменения. Это позволяет игроку летать в реальных ураганах или отслеживать реальные коммерческие авиалайнеры на их точной траектории полета, пока они находятся в воздухе в реальном мире. Это означает, что пользователи не могут “предварительно купить” или “предварительно загрузить” все MSFS - большая их часть еще не существует!

Microsoft Flight Simulator работает за счет хранения относительно небольшой части “игры” на устройстве пользователя — примерно 150 ГБ. Этой части достаточно для запуска игры — она содержит весь код игры, визуальную информацию для многочисленных самолетов и ряд карт. В результате MSFS можно использовать в автономном режиме. Однако автономные пользователи видят в основном процедурно сгенерированные среды и объекты, с такими достопримечательностями, как Манхэттен, широко знакомыми, но населенными типовыми, в основном дублированными зданиями, которые имеют лишь случайное, а иногда и случайное сходство со своими аналогами в реальном мире. Существуют некоторые запрограммированные траектории полета, но они не могут имитировать реальные живые маршруты, и один игрок не может видеть самолет другого игрока.

Именно когда игроки выходят в Интернет, MSFS становится настоящим чудом, поскольку серверы Microsoft транслируют новые карты, текстуры, данные о погоде, траектории полета и любую другую информацию, которая может понадобиться пользователю. В некотором смысле игроки воспринимают мир MSFS точно так же, как это мог бы сделать реальный пилот. Когда они пролетают над горой или вокруг нее, новая информация поступает в их сетчатку с помощью световых частиц, открывая, а затем проясняя то, что там находится в первый раз. До этого пилот знает только то, что, по логике вещей, там что-то должно быть.

Многие геймеры предполагают, что именно это происходит во всех многопользовательских онлайн-видеоиграх. Но правда в том, что большинство онлайн-игр стараются отправить пользователю как можно больше информации заранее и как можно меньше во время игры. Это объясняет, почему для игры, даже в относительно небольшую игру, такую как Super Mario Bros., требуется покупать цифровые диски, содержащие многогигабайтные игровые файлы, или тратить часы на загрузку этих файлов, а затем тратить еще больше времени на их установку. А затем время от времени нам могут посоветовать загрузить и установить многогигабайтное обновление, прежде чем мы сможем играть снова. Эти файлы настолько велики, потому что они содержат почти всю игру, а именно ее код, игровую логику и все ресурсы и текстуры, необходимые для внутриигровой среды (каждый тип дерева, каждый аватар, каждое сражение с боссом, каждое оружие и так далее).

Что на самом деле происходит с сетевыми многопользовательскими серверами для типичной онлайн-игры? Немного. Размер файлов игр Fortnite для ПК и консолей составляет примерно 30 ГБ, но для онлайн—игры требуется всего 20-50 МБ (или 0,02-0,05 ГБ) загружаемых данных в час. Эта информация сообщает устройству игрока, что делать с уже имеющимися у него данными. Например, если вы играете в онлайн-игру Mario Kart, серверы Nintendo сообщат вашему Nintendo Switch, какие аватары используют ваши оппоненты, и поэтому их следует загрузить. Во время матча ваше постоянное соединение с этим сервером позволяет ему отправлять постоянный поток данных о том, где именно находятся эти соперники (“позиционные данные”), что они делают (посылают в вас красную ракушку), сообщения (например, аудио вашего товарища по команде) и различную другую информацию, например, сколько игроков все еще находится в матче.

То, что онлайн-игры остаются “в основном оффлайн”, удивляет даже заядлых геймеров. В конце концов, большая часть музыки и видео теперь транслируется в потоковом режиме — мы больше не загружаем песни или телешоу заранее, не говоря уже о покупке физических компакт—дисков для их хранения, - а видеоигры, предположительно, являются более технически сложной и перспективной категорией медиа. И все же именно потому, что игры настолько сложны, те, кто их создает, предпочитают маргинализировать Интернет — потому что Интернет ненадежен. Соединения ненадежны, пропускная способность ненадежна, задержка ненадежна. Как я обсуждал в главе 3, большинство онлайн-сервисов могут пережить эту ненадежность, но игры - нет. В результате разработчики решили как можно меньше полагаться на Интернет.

Этот в основном автономный подход к онлайн-играм работает хорошо, но он накладывает много ограничений. Например, тот факт, что сервер может указывать только отдельным пользователям, какие ресурсы, текстуры и модели должны отображаться, означает, что каждый ресурс, текстура и модель должны быть известны и сохранены заранее. Отправляя данные рендеринга по мере необходимости, игры могут иметь гораздо большее разнообразие виртуальных объектов. Microsoft Flight Simulator стремится к тому, чтобы каждый город не просто отличался друг от друга, но и существовал так, как они существуют в реальной жизни. И он не хочет хранить 100 типов облаков, а затем указывать устройству, какое облако отображать и с какой раскраской; скорее, он хочет точно сказать, как это облако должно выглядеть.

Когда игрок видит своего друга в Fortnite сегодня, он может взаимодействовать, используя только ограниченный набор предварительно загруженных анимаций (или “эмоций”), таких как волна или лунная походка. Однако многие пользователи представляют себе будущее, в котором их жизненные движения лица и тела будут воссозданы в виртуальном мире. Чтобы поприветствовать друга, они не будут выбирать волну 17 из 20 волн, предварительно загруженных на их устройство, но будут махать уникально артикулированными пальцами уникальным способом. Пользователи также надеются перенести свои бесчисленные виртуальные предметы и аватары через множество виртуальных миров, подключенных к Метавселенной. Как следует из размера файла MSFS, просто невозможно отправить столько данных пользователю заранее. Для этого требуются не только непрактично большие жесткие диски, но и виртуальный мир, который заранее знает все, что может быть создано или выполнено.

Необходимость “представлять” виртуальный мир, в остальном живой, имеет и другие последствия. Каждый раз, когда Epic Games изменяет виртуальный мир Fortnite — скажем, чтобы добавить новые пункты назначения, транспортные средства или неигровых персонажей, - пользователям приходится загружать и устанавливать обновление. Чем больше Epic добавляет, тем больше времени это занимает и тем дольше пользователь должен ждать. Чем чаще обновляется мир, тем больше задержек будет испытывать пользователь.

Пакетный процесс обновления также означает, что виртуальные миры не могут быть по-настоящему “живыми”. Вместо этого центральный сервер выбирает отправку определенной версии виртуального мира всем пользователям, мира, который будет существовать до тех пор, пока его не заменит следующее обновление. Каждое издание не обязательно является фиксированным — обновление может содержать запрограммированные изменения, такие как событие в канун Нового года или снегопад, который усиливается с каждым днем, — но оно предварительно разработано по сценарию.

Наконец, существуют ограничения на то, куда могут заходить пользователи. Во время 10-минутного мероприятия Трэвиса Скотта на Fortnite около 30 миллионов игроков мгновенно перенеслись с основной карты игры в глубины невиданного ранее океана, затем на невиданную ранее планету, а затем глубоко в открытый космос. Многие из нас могут вообразить, что Метавселенная работает аналогичным образом — что пользователи могут легко переходить из виртуального мира в виртуальный мир, предварительно не выдерживая длительного времени загрузки. Но чтобы организовать концерт, Epic пришлось отправлять пользователям каждый из этих мини-миров за несколько дней или часов до события через стандартный патч Fortnite (пользователи, которые не загрузили и не установили обновление до начала события, не смогли принять в нем участие). Затем, во время каждого сета, устройство каждого игрока загружало следующий сет в фоновом режиме. Примечательно, что каждое из концертных направлений Скотта было меньше и более ограниченным, чем предыдущее, причем последнее было в основном “на рельсах”, в котором пользователи просто летели вперед в практически неописуемом пространстве. Думайте об этом как о разнице между свободным посещением торгового центра и перемещением по нему по движущейся дорожке.

Концерт, тем не менее, был значительным творческим достижением, но, как это часто бывает с онлайн-играми, он зависел от технических решений, которые не могут поддерживать Метавселенную. Фактически, большинство виртуальных миров, похожих на Метавселенную, сегодня используют гибридную локальную/облачную потоковую модель данных, в которой предварительно загружается “основная игра”, но по мере необходимости отправляется в несколько раз больше данных. Этот подход менее важен для таких игр, как Mario Kart или Call of Duty, которые имеют относительно небольшое разнообразие предметов и окружающей среды, но критически важны для таких игр, как Roblox и MSFS.

Учитывая популярность Roblox и необъятность MSFS, может показаться, что современная интернет-инфраструктура теперь может обрабатывать потоковую передачу данных в режиме реального времени в стиле Метавселенной. Однако сегодня эта модель работает только в очень ограниченном режиме. Roblox, например, не нуждается в облачном потоке большого количества данных, потому что большинство его внутриигровых предметов основаны на “pre-fabs”. Игра в основном просто сообщает устройству пользователя, как настроить, перекрасить или переставить ранее загруженные элементы. Кроме того, графическая точность Roblox относительно скромна, и поэтому размеры ее текстур и файлов окружающей среды также относительно невелики. В целом, использование данных Roblox намного больше, чем у Fortnite — примерно 100-300 МБ в час, а не 30-50 МБ, — но все же управляемо.

При своих целевых настройках MSFS требуется почти в 25 раз больше почасовой пропускной способности, чем Fortnite, и в пять раз больше, чем Roblox. Это связано с тем, что он не отправляет данные о том, как перенастроить или перекрасить предварительно загруженный дом, а вместо этого отправляет на устройство пользователя точные размеры, плотность и окраску многокилометрового облака или почти точную копию береговой линии Мексиканского залива. Тем не менее, даже эта потребность упрощается способами, которые не будут работать для “Метавселенной”.

В то время как MSFS требуется много данных, она не нуждается в них особенно быстро. Как и в случае с пилотами реального мира, пилоты MSFS не могут внезапно телепортироваться из штата Нью-Йорк в Новую Зеландию, не могут увидеть центр Олбани с высоты 30 000 футов над Манхэттеном или спуститься с небосвода на летное поле за несколько минут. Это дает устройству игрока много времени для загрузки необходимых ему данных и даже возможность предсказать (и, следовательно, начать загрузку), что ему нужно, еще до того, как игрок выберет пункт назначения. Даже если эти данные не поступят вовремя, последствия будут скромными: некоторые здания Манхэттена будут временно сгенерированы процедурно, а не похожи на реальные объекты, с добавлением реалистичных деталей по мере их поступления.

Наконец, виртуальный мир MSFS имеет больше общего с диорамой, чем с шумной и непредсказуемой улицей Нила Стивенсона. Для отправки пользователям такого рода данных, которые нелегко предсказать и которые намного объемнее, чем визуальные детали офисного парка или леса, потребуется значительно больше 1 ГБ в час. Это подводит нас к следующему и, возможно, наименее изученному элементу подключения к Интернету на сегодняшний день: задержке.

### Latency (задержка)

Пропускная способность и задержка часто смешиваются, и ошибка понятна: они оба влияют на то, сколько данных может быть отправлено или получено в единицу времени. Классический способ провести различие между ними - сравнить ваше подключение к Интернету с автомагистралью. Вы можете думать о “пропускной способности” как о количестве полос движения на шоссе, а о “задержке” как об ограничении скорости. Если на шоссе больше полос движения, по нему может проехать больше легковых и грузовых автомобилей без заторов. Но если ограничение скорости на шоссе низкое — возможно, из—за слишком большого количества поворотов или из-за того, что оно проложено по гравию, а не по асфальту, - тогда поток транспорта замедляется, даже если есть свободная пропускная способность. Точно так же ограничение высокой скорости только с одной полосой движения также приводит к постоянным заторам — ограничение скорости - это стремление, а не реальность.

Проблема с виртуальными мирами, визуализируемыми в реальном времени, заключается в том, что пользователи не отправляют ни одного автомобиля из одного пункта назначения в другой. Вместо этого они отправляют бесконечный парк автомобилей, связанных вместе (помните, нам нужна “непрерывная связь”) как в этот пункт назначения, так и из него. Отправить эти автомобили заранее невозможно, потому что их содержимое определяется всего за миллисекунды до того, как они отправятся в путь. Более того, нам нужно, чтобы эти автомобили двигались с максимально возможной скоростью и никогда не переключались на другой маршрут (что нарушило бы непрерывное соединение и увеличило бы время в пути, даже если бы сохранялась максимальная скорость).

Глобальная дорожная система, отвечающая и поддерживающая эти требования, представляет собой серьезную проблему. В части 1 я объяснил, что сегодня немногим онлайн-сервисам требуется сверхнизкая задержка. Не имеет значения, требуется ли 100 миллисекунд, 200 миллисекунд или даже двухсекундная задержка между отправкой сообщения WhatsApp и получением квитанции о прочтении. Также не имеет значения, проходит ли 20 мс, 150 мс или 300 мс после того, как пользователь нажимает кнопку паузы YouTube, пока видео не остановится — и большинство пользователей, вероятно, не замечают разницы между 20 мс и 50 мс. Когда вы смотрите Netflix, более важно, чтобы видео воспроизводилось надежно, а не сразу. И хотя задержка при видеовызове с масштабированием раздражает, участникам легко справиться с ней; они просто учатся немного ждать после того, как говорящий перестает говорить. Даже секунда (1000 мс) вполне выполнима.

Человеческий порог задержки при интерактивном взаимодействии невероятно низок. Пользователь должен инстинктивно чувствовать, что его вводимые данные действительно оказывают влияние, а запоздалые ответы означают, что “игра” реагирует на старые решения после принятия новых решений. По этой же причине, играя против пользователя с меньшей задержкой, часто может показаться, что вы соревнуетесь с кем—то в будущем — с кем-то со сверхскоростью, - кто способен парировать удар, который вы даже не нанесли.

Вспомните, когда вы в последний раз смотрели фильм или телешоу в самолете, на iPad или в кинотеатре, и аудио и видео были немного не синхронизированы. Среднестатистический человек даже не замечает проблемы с синхронизацией, если только звук не появляется более чем на 45 мс раньше или более чем на 125 мс позже (общее отклонение 170 мс). Пороги приемлемости, как их обычно называют, еще шире: 90 мс в начале и 185 мс в конце (275 мс). С помощью цифровых кнопок, таких как кнопка паузы YouTube, среднестатистический пользователь думает, что его щелчок не удался, только если ответ занимает от 200 до 250 мс. В таких играх, как Fortnite, Roblox или Grand Theft Auto, заядлые геймеры разочаровываются после 50 мс задержки (большинство издателей игр надеются на 20 мс). Даже обычные геймеры считают, что в 110 мс виновата задержка ввода, а не их неопытность.*3* При 150 мс игры, требующие быстрой реакции, просто неиграбельны.

Итак, как выглядит задержка на практике? В Соединенных Штатах среднее время отправки данных из одного города в другой и обратно составляет 35 мс. Многие пары превышают этот показатель, особенно между городами с высокой плотностью населения и интенсивными пиками спроса (например, из Сан-Франциско в Нью-Йорк в вечернее время). Важно отметить, что это всего лишь транзитное время от города к городу или от центра обработки данных к центру обработки данных. По-прежнему существует транзитное время от центра города до пользователя, которое особенно подвержено замедлению. Плотные города, локальные сети и отдельные кондоминиумы могут легко объединяться и часто прокладываются с помощью медных кабелей с ограниченной полосой пропускания, а не оптоволокна большой емкости. Те, кто живет за пределами крупного города, могут находиться в конце десятков или даже сотен миль передачи на основе меди. Для тех, чья последняя миля проходит по беспроводной сети, 4G добавляет до 40 дополнительных миллисекунд.

Несмотря на эти проблемы, сроки доставки в оба конца в Соединенных Штатах, как правило, находятся в пределах приемлемого порога. Однако все соединения страдают от “jitter” (неустойчивая синхронизация, скачки пинга), разницы во времени доставки от пакета к пакету относительно медианы. Хотя большая часть джиттера жестко распределена вокруг средней задержки соединения, он часто может увеличиваться в несколько раз из—за непредвиденной перегрузки где-то на сетевом пути, включая сеть конечных пользователей в результате помех от других электронных устройств или, возможно, члена семьи или соседа, инициирующего видеопоток или загрузку. Хотя это и временно, это может легко испортить быстро развивающуюся игру или привести к разрыву сетевого соединения. Опять же, сети ненадежны.

Чтобы справиться с задержкой, индустрия онлайн-игр разработала ряд частичных решений и обходных путей. Например, большинство высокоточных многопользовательских игр “подбираются” по регионам серверов. Ограничивая список игроков теми, кто живет на северо-востоке Соединенных Штатов, в Западной Европе или Юго-Восточной Азии, издатели игр могут свести к минимуму задержки в каждом регионе. Поскольку игры - это досуг, и в них обычно играют от одного до трех друзей, такая кластеризация работает достаточно хорошо. Вряд ли вы захотите играть с конкретным человеком, находящимся в нескольких часовых поясах от вас, и вам все равно, где живут ваши неизвестные оппоненты (в большинстве случаев вы даже не можете с ними поговорить).

Многопользовательские онлайн-игры также используют решения “netcode” для обеспечения синхронизации и согласованности, а также для поддержания игры игроков. Сетевой код, основанный на задержке, будет указывать устройству игрока (скажем, PlayStation 5) искусственно задерживать рендеринг входных данных своего владельца до тех пор, пока не поступят входные данные более скрытого игрока (их противника). Это будет раздражать игроков с мышечной памятью, настроенной на низкую задержку, но это работает. Откат сетевого кода является более сложным. Если вводы противника задерживаются, устройство игрока будет действовать в соответствии с тем, что оно ожидает. Если выяснится, что противник сделал что—то другое, устройство попытается размотать анимацию в процессе, а затем воспроизвести ее “правильно”.

Хотя эти обходные пути эффективны, они плохо масштабируются. Netcode хорошо работает для игр, в которых входные данные игрока достаточно предсказуемы, таких как симуляторы вождения, или для игр с относительно небольшим количеством игроков для синхронизации, как это имеет место в большинстве файтингов. Однако в геометрической прогрессии становится все труднее правильно прогнозировать и согласованно синхронизировать поведение десятков игроков, особенно когда они участвуют в виртуальном мире в стиле песочницы с облачными потоковыми данными об окружающей среде и активах. Вот почему Subspace, компания, занимающаяся технологиями пропускной способности в реальном времени, подсчитала, что только три четверти американских широкополосных домов могут постоянно (но далеко не безупречно) участвовать в современных высокоточных виртуальных мирах в реальном времени, таких как Fortnite и Call of Duty, в то время как на Ближнем Востоке это может сделать менее четверти. И достижения порога задержки недостаточно. Subspace обнаружил, что увеличение или уменьшение задержки в среднем на 10 мс сокращает или увеличивает еженедельное время воспроизведения на 6%. Более того, эта корреляция сохраняется за пределами того уровня, когда даже заядлые геймеры могут распознать задержку в сети — если их соединение составляет 15 мс, а не 25 мс, они, скорее всего, будут играть на 6% дольше. Почти ни один другой вид бизнеса не сталкивается с такой чувствительностью, а поскольку игры - это бизнес, основанный на вовлечении, последствия для доходов значительны.

Это может показаться проблемой, относящейся к конкретной игре, а не к проблеме Метавселенной. Также примечательно, что эти проблемы затрагивают лишь часть доходов от игр. Многие популярные игры, такие как Hearthstone и Words with Friends, либо пошаговые, либо асинхронные, в то время как другие синхронные игры, такие как Honor of Kings и Candy Crush, не требуют ввода ни с точностью до пикселя, ни с точностью до миллисекунды. Тем не менее, для Метавселенной потребуется низкая задержка. Легкие движения лица невероятно важны для человеческого общения. Мы также очень чувствительны к небольшим ошибкам и проблемам с синхронизацией — вот почему нас не волнует, как двигаются рты мультяшного персонажа Pixar, но нас быстро пугает фотореальный CGI-человек, чьи губы двигаются не совсем правильно (аниматоры называют это “жуткой долиной”). Разговор с вашей матерью так, как будто она находится с задержкой в 100 мс, может быстро стать жутким. В то время как взаимодействия в Метавселенной не имеют такой чувствительности ко времени, как маркер, зависящий от конкретного пикселя, объем требуемых данных намного больше. Напомним, что задержка и пропускная способность в совокупности влияют на то, сколько информации может быть отправлено в единицу времени.

Социальные продукты, к сожалению, зависят от того, сколько пользователей могут и используют их. Хотя в большинство многопользовательских игр играют с другими людьми, находящимися в том же часовом поясе или, возможно, удаленными друг от друга, интернет-общение часто охватывает весь земной шар. Ранее я упоминал, что для отправки данных с северо-востока США на юго-восток США может потребоваться 35 мс. Путешествие между континентами занимает еще больше времени. Среднее время доставки с Северо—востока США в Северо-Восточную Азию составляет 350 или 400 мс, а от пользователя к пользователю - еще больше (от 700 мс до 1 полной секунды). Только представьте, если бы FaceTime или Facebook не работали, если бы ваши друзья или родственники не находились в радиусе 500 миль. Или они работали только тогда, когда вы были дома. Если компания хочет использовать иностранную или удаленную рабочую силу в виртуальном мире, ей потребуется больше, чем полсекундные задержки. Каждый дополнительный пользователь в виртуальном мире только усугубляет проблемы с синхронизацией.

Опыт, основанный на дополненной реальности, предъявляет особенно строгие требования к задержке, поскольку он основан как на движениях головы, так и на движениях глаз. Если вы носите очки, вы можете считать само собой разумеющимся, что ваши глаза немедленно приспосабливаются к окружающей обстановке, когда вы поворачиваетесь и получаете световые частицы с частотой 0,00001 мс. Но представьте, что бы вы чувствовали, если бы при получении этой новой информации были задержки в 10-100 мс.

Задержка - это самое большое сетевое препятствие на пути к Метавселенной. Отчасти проблема заключается в том, что сегодня лишь немногие сервисы и приложения нуждаются в доставке со сверхнизкой задержкой, что, в свою очередь, усложняет задачу любому сетевому оператору или технологической компании, ориентированной на доставку в режиме реального времени. Хорошей новостью здесь является то, что по мере роста Метавселенной будут увеличиваться инвестиции в интернет-инфраструктуру с меньшей задержкой. Однако борьба за преодоление задержки не просто растягивает наши кошельки; она противоречит законам физики. Процитируем генерального директора одного из ведущих издателей видеоигр, имеющего опыт создания игр для доставки в облако: “Мы находимся в постоянной битве со скоростью света. Но скорость света есть и останется непобедимой”. Подумайте, насколько сложно отправить даже один байт из Нью-Йорка в Токио или Мумбаи со сверхнизкой задержкой. На расстоянии 11 000 — 12 500 км эта поездка занимает 40-45 мс. Физика вселенной превосходит целевой минимум для конкурентных видеоигр только на 10%-20%. Это не похоже на то, что мы проигрываем законам физики. Но на практике мы далеко не дотягиваем до этого контрольного показателя в 40-45 мс. Средняя задержка пакета, отправленного из центра обработки данных Amazon на северо-востоке США (который обслуживает Нью-Йорк) в центр обработки данных в Юго-Восточной Азии и Тихоокеанском регионе (Мумбаи и Токио), составляет 230 мс.

Есть много причин для этой задержки. Один из них - кварцевое стекло. Хотя многие предполагают, что данные, передаваемые по волоконно-оптическим кабелям, распространяются со скоростью света, они как правы, так и ошибочны. Сами световые лучи действительно движутся со скоростью света, которая, как известно любому студенту, является постоянной, но они не движутся по прямой линии, даже когда сам кабель проложен по прямой линии. Это происходит потому, что все стеклянные волокна, в отличие от космического вакуума, преломляют свет. Таким образом, траектория данного луча ближе к плотному зигзагообразному отражению между краями данного волокна. В результате маршрут удлиняется почти на 31%. Это приводит нас к 58 или 65 мс.

Кроме того, большинство интернет—кабелей прокладываются не по прямой - они должны учитывать международные права, географические препятствия и анализ затрат и выгод. В результате во многих странах и крупных городах отсутствует прямое сообщение. Нью-Йорк имеет прямой подводный кабель с Францией, но не с Португалией. Трафик из Соединенных Штатов может идти прямо в Токио, но для достижения Индии требуется перепрыгивать с одного подводного кабеля на другой на азиатском или океанском континенте. Один кабель можно было бы проложить из Соединенных Штатов в Индию, но для этого нужно было бы пройти через Таиланд или вокруг него, что добавило бы сотни или даже тысячи миль, а это решает проблему передачи данных только от берега к берегу.

Возможно, удивительно, но улучшить внутреннюю интернет-инфраструктуру сложнее, чем международную интернет-инфраструктуру. Прокладка (или замена) кабелей означает работу вокруг обширной транспортной инфраструктуры (автострады и железные дороги), различных населенных пунктов (каждый со своими политическими процессами, избирательными округами и стимулами), а также охраняемых парков и земель. Прокладка кабеля через подводную гору в международных водах проста по сравнению с прокладкой кабеля через частно-общественный горный хребет.
![[карта интернет-кабели.png|600]]

Фраза “магистраль интернета” может вызвать в памяти в значительной степени спланированную и частично объединенную сеть кабелей. По правде говоря, магистраль Интернета на самом деле представляет собой свободную федерацию частных сетей. Эти сети никогда не были созданы для того, чтобы быть эффективными на национальном уровне. Скорее, они служат местным целям. Например, частная компания-оператор сети могла бы проложить оптоволоконную линию между двумя пригородами или даже двумя офисными парками. Учитывая затраты на получение разрешений и эффективность использования существующих усилий, вместо того, чтобы соединять пару городов, как ворона летит, кабель часто прокладывался тогда, когда и где строилась другая инфраструктура.

Когда данные передаются между двумя городами, такими как Нью-Йорк и Сан-Франциско или, если уж на то пошло, Лос-Анджелес и Сан-Франциско, они могут передаваться несколькими различными сетями, соединенными вместе (каждый сегмент называется переходом). Ни одна из этих сетей не была спроектирована таким образом, чтобы свести к минимуму расстояние или транзитное время между этими двумя точками. Соответственно, данный пакет может перемещаться значительно дальше, чем буквальное географическое расстояние между пользователем и сервером.

Эта проблема усугубляется Border Gateway Protocol (BGP), одним из основных протоколов прикладного уровня TCP/IP. Как вы читали в главе 3, BGP служит своего рода диспетчером воздушного движения для данных, передаваемых “в Интернете”, помогая каждой сети определять, через какую другую сеть направлять данные. Однако он делает это, не зная, что посылается, в каком направлении или с каким значением. Как таковой, он “помогает”, применяя довольно стандартизированную методологию, которая в основном определяет приоритеты затрат.

Набор правил BGP отражает оригинальный дизайн асинхронной сети Интернета. Его цель - обеспечить успешную и недорогую передачу всех данных. Но в результате многие маршруты намного длиннее, чем необходимо, и это непоследовательно. Два игрока, расположенные в одном и том же здании на Манхэттене, могут участвовать в одном матче Fortnite, управляемом сервером Fortnite из Вирджинии, с пакетами, которые могут сначала проходить через Огайо и, таким образом, достигать места назначения на 50% дольше. Данные могут быть отправлены обратно одному из игроков по еще более длинному сетевому пути, который проходит через Чикаго. И любое из этих соединений может в конечном итоге прерваться или страдать от повторяющихся приступов задержки в 150 мс, и все это для приоритизации трафика, который не нужно доставлять в режиме реального времени, например, по электронной почте.

Все эти факторы вместе объясняют, почему среднему пакету данных требуется более чем в четыре раза больше времени, чтобы добраться из Нью-Йорка в Токио, чем частице света, в пять раз больше времени от Нью-Йорка до Мумбаи и в два-четыре раза больше времени, чтобы добраться до Сан-Франциско, в зависимости от момента.

Увеличение времени доставки будет невероятно дорогостоящим, сложным и медленным. Замена или модернизация кабельной инфраструктуры не только обходится дорого, но и требует одобрения правительства, как правило, на нескольких уровнях. Чем более прямой предполагаемый путь этих кабелей, тем сложнее получить эти разрешения, поскольку более прямой путь с большей вероятностью приведет к предыдущему жилому, коммерческому, правительственному или экологически защищенному имуществу.

Гораздо проще модернизировать беспроводную инфраструктуру. Сети 5G в первую очередь рекламируются как предлагающие пользователям беспроводной связи “сверхнизкую задержку” с потенциалом в 1 мс и более реалистичным ожидаемым значением в 20 мс. Это означает экономию на 20-40 мс по сравнению с современными сетями 4G. Однако это помогает только на последних нескольких сотнях метров передачи данных. Как только данные беспроводного пользователя попадают в вышку, они перемещаются на магистральные линии фиксированной связи.

Starlink, спутниковая интернет-компания SpaceX, обещает обеспечить широкополосный доступ в Интернет с низкой задержкой по всей территории Соединенных Штатов, а в конечном итоге и по всему остальному миру. Однако спутниковый интернет не обеспечивает сверхнизкой задержки, особенно на больших расстояниях. По состоянию на 2021 год время в пути Starlink от вашего дома до спутника и обратно составляет в среднем 18-55 мс, но этот временной интервал увеличивается, когда данные должны передаваться из Нью-Йорка в Лос-Анджелес и обратно, поскольку для этого требуется пересечение нескольких спутников или традиционных наземных сетей.

В некоторых случаях Starlink даже усугубляет проблему расстояний в пути. Расстояние от Нью-Йорка до Филадельфии составляет около 100 миль по прямой и, возможно, 125 миль по кабелю, но более 700 миль при полете на низкоорбитальный спутник и обратно. Мало того, волоконно-оптический кабель гораздо менее “подвержен потерям”, чем свет, проходящий через атмосферу, особенно в пасмурные дни. Густонаселенные городские районы, поскольку они шумные, также подвержены помехам по этой причине. В 2020 году Илон Маск подчеркнул, что Starlink ориентирована “на самых труднодоступных клиентов, с которыми [телекоммуникационным компаниям] в противном случае было бы трудно связаться”*4*. В этом смысле спутниковая доставка позволяет большему количеству людей соответствовать минимальным требованиям к задержке для Метавселенной, а не предлагает улучшения для тех, кто уже соответствует им.

Border Gate Protocol может быть обновлен или дополнен другими протоколами, или могут быть введены и приняты новые собственные стандарты. В любом случае, нам нравится воображать, что то, что возможно, ограничено только умом и инновациями корпорации Roblox, или Epic Games, или отдельного создателя, и это правда, что эти группы доказали свою способность проектировать с учетом сетевых ограничений. Они будут продолжать делать это по мере того, как мы будем решать все предстоящие проблемы с пропускной способностью и задержкой. Однако, по крайней мере, в ближайшем будущем эти слишком реальные ограничения будут продолжать сдерживать Метавселенную и все в ней.