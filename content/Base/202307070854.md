202307070854
***
[[Godot Engine-блог]]
***
# Godot 4.1 уже здесь, более плавный, надежный и с множеством новых функций
После четырех месяцев работы мы рады представить вам Godot 4.1! Это обновление, которое соответствует нашему обещанию улучшать Godot 4.0 с помощью частых дополнительных выпусков — с акцентом на стабильность, производительность и отточенность.  
  
Как всегда, новый релиз поставляется с кучей долгожданных новых функций, таких как улучшенное управление навигацией с помощью искусственного интеллекта и возможность отсоединять редакторы кода и размещать их на других дисплеях.

![[Godot detached-code-editor.png|1000]]

Тем не менее, мы уделили большое внимание приоритизации ошибок, с которыми вы столкнулись в версии 4.0. Это обновление исправляет более 900 проблем, о которых пользователи сообщили при использовании Godot 4 или при оказании помощи участникам в тестировании 4.1 с помощью предварительных сборок. Движок в целом должен казаться более надежным. Мы продолжим улучшать стабильность, производительность и рабочие процессы с каждым новым выпуском функций Godot 4.  
  
Для большинства игр и приложений, созданных с версии 4.0, переход на версию 4.1 должен быть относительно безопасным. Мы готовим [руководство по миграции](https://github.com/godotengine/godot-docs/pull/7611), в котором описано все, на что вам нужно обратить внимание при переносе вашего проекта. Некоторые несоответствия ожидаются, в частности, для пользователей C# и GDExtension, однако мы работаем над тем, чтобы избежать этого в будущих выпусках. Не забывайте всегда создавать резервные копии при перемещении версий, даже незначительных. А еще лучше, отдайте предпочтение системе контроля версий, такой как Git, и зафиксируйте версию своего проекта перед переносом.  
  
**Если вы хотите сразу приступить к действию, вы можете** [загрузить Godot 4.1](https://godotengine.org/download/windows/) прямо сейчас. Или оставайтесь поблизости и читайте больше о наиболее заметных изменениях в этом выпуске. Вы также можете посмотреть это замечательное видео с основными моментами от [GDQuest](https://www.gdquest.com/)

https://youtu.be/PAtG_fHhIx8

## Giving back

В рамках усилий сообщества Godot полагается на индивидуальных участников в совершенствовании. В последние годы [пожертвования пользователей и компаний](https://godotengine.org/donate/) позволили нам также нанять ряд основных авторов, чтобы они работали над движком полный рабочий день и выпускали для вас эти быстро развивающиеся релизы.  
  
Наши ежемесячные расходы по-прежнему превышают ежемесячные пожертвования, и мы по-прежнему зависим от крупных разовых пожертвований компаний для финансирования развития. В настоящее время нам нужно намного больше ежемесячных пожертвований, чтобы не отставать от темпов обновления Godot 4, не говоря уже о необходимости нанимать больше сопровождающих для проверки каждого вклада.  
  
Помимо финансовой поддержки, вы также можете вернуть деньги, написав подробные отчеты об ошибках, внеся свой вклад в базу кода, написав документацию, написав руководства (для документов или на вашем собственном веб-сайте) и поддерживая других на различных [платформах сообщества](https://docs.godotengine.org/en/latest/community/channels.html), отвечая на вопросы и предоставляя полезные советы.  
  
И последнее, но не менее важное: создание игр на Godot и оценка движка имеют большое значение для того, чтобы сделать его более популярным и убедить больше людей внести свой вклад и улучшить Godot для всех. Помните, мы все участвуем в этом вместе, и Godot нуждается в поддержке сообщества во всех областях, чтобы процветать.

## Highlights
Этот релиз стал возможен благодаря заявкам более 300 участников! Мы горячо благодарим всех вас за вашу работу и самоотверженность, включая тех, кто помог нам протестировать движок перед выпуском и отправить отчеты об ошибках.  
  
Для получения исчерпывающего списка всех исправлений ошибок и улучшений перейдите к нашему [интерактивному списку изменений](https://godotengine.github.io/godot-interactive-changelog/#4.1).  
  
Без лишних слов, вот разбивка основных изменений и новых функций.

### Performance
Игры Godot построены в виде дерева узлов, которые являются базовым строительным блоком движка для игровых объектов. Добавление и удаление узлов - это операции, которые движку приходится выполнять чрезвычайно часто, поэтому они должны выполняться как можно быстрее.  
  
В версии 4.1 мы изменили алгоритм на использование быстрой хэш-карты, чтобы в несколько раз ускорить добавление и удаление дочерних узлов. В результате операции с необычными узлами выполняются немного медленнее, а объем памяти базового класса узлов на 10% выше, но это небольшой и необходимый компромисс ради большой выгоды для всех пользователей Godot, особенно для более сложных проектов с большим количеством манипуляций с узлами.  
  
В этой версии также представлена экспериментальная многопоточность для ваших сцен, функция, запущенная [Хуаном Линиецки](https://github.com/reduz). Новые свойства узла дают вам полный контроль над тем, как обрабатываются узлы, последовательно или параллельно.

![[Godot threaded-node-properties-highlighted.png|500]]

Как уже упоминалось, функция в настоящее время помечена как экспериментальная, поскольку требует тщательного тестирования для выявления крайних случаев. Мы пока не рекомендуем использовать ее в производстве. Но она закладывает основу для максимально эффективного использования современного оборудования с простыми элементами управления.  
  
Также в области многопоточности [Педро Дж. Эстебанес](https://github.com/RandomShaper) усердно работал над устранением большого количества проблем и ограничений при многопоточной загрузке.  
  
Что касается рендеринга, программа визуализации Vulkan получила конвейерный кэш. В то время как Godot уже кэшировал шейдеры, чтобы уменьшить заикание при компиляции шейдеров, компиляция конвейеров все еще приводит к некоторым заиканиям и замедлению загрузки. Хотя проблема с заиканием при компиляции конвейера далека от решения, это представляет собой шаг в правильном направлении и также должно привести к небольшому сокращению времени загрузки при использовании одного из серверных интерфейсов рендеринга на основе RenderingDevice. Этот кэш можно отключить в настройках проекта, и он включен по умолчанию в Godot 4.1.

![[Godot shader-cache-setting.png|1000]]

Это улучшение не устраняет все возможные причины зависаний, но это первый шаг [Александра Стренга](https://github.com/warriormaster12) в правильном направлении. Мы продолжим работать над этим в следующих выпусках.  
  
В течение всего года будет проделана дополнительная работа по повышению производительности.

### Core
При импорте моделей в Godot часто возникала проблема, заключавшаяся в том, что они оказывались обращенными вспять.

![[Godot model-facing-back.webp|1000]]

[Хуан Линиецки](https://github.com/reduz), [Токаге](https://github.com/TokageItLab) и [Аарон Франке](https://github.com/aaronfranke) разработали несколько способов решения этой проблемы. Одно из реализованных изменений меняет местами направления передней и задней камер в редакторе. Кроме того, функция `look_at()` теперь имеет аргумент для использования пространства модели в качестве ориентира для просмотра вперед вместо минус оси Z камеры. Эти изменения также помогают исправить давнюю ошибку со следованием пути.

Это обновление также добавляет сглаживание дельты кадра в Godot 4 от [lawnjelly](https://github.com/lawnjelly). Это может значительно улучшить плавность движения и сделать игровой процесс более плавным. Эта опция включена по умолчанию, хотя, пожалуйста, обратите внимание, что она работает только тогда, когда VSync также включена.

### Scripting

#### GDScript
До сих пор в GDScript для обмена данными между несколькими экземплярами одного и того же скрипта требовалось использовать ресурс или автозагрузку.  
  
Благодаря [Джорджу Маркесу](https://github.com/vnen) теперь вместо этого вы можете создавать и использовать статические переменные. Статические переменные хранят данные в классе, а не в каждом экземпляре, поэтому они являются общими для всех экземпляров класса.  
  
Чтобы сделать переменную статической, добавьте ключевое слово `static` перед переменной, определенной в верхней части вашего скрипта.

![[Godot gdscript-static-variables.png|500]]

Отличной функцией GDScript, добавленной в Godot 4, является автоматическая генерация страниц документации для ваших именованных классов.

![[Godot gdscript-docs-generation.png|1000]]

Эта версия включает переработку системы [ocean](https://github.com/anvilfolk), которая теперь обрабатывает перечисления как типы, делая сгенерированную документацию более точной. Теперь вы также можете использовать встроенные строки документации вместо того, чтобы всегда размещать их над определением переменной или функции.

```
var my_variable = 10 ## This is an inline docstring
```

#### C#/.NET

Основное внимание в этом выпуске было уделено обеспечению равенства функций между C# и GDScript.  
  
При использовании GDScript вы можете определить новый тип узла для использования в редакторе, добавив глобальное имя класса в свой скрипт.  
  
Начиная с Godot 4.1, это также возможно в C # путем добавления атрибута `[GlobalClass]` к вашему файлу, благодаря [Раулю Сантосу](https://github.com/raulsntos) и [Уиллу Нэйшенсу](https://github.com/willnationsdev). Вы также можете использовать атрибут `[Icon]`, чтобы присвоить вашему глобальному классу уникальный значок.

Обратите внимание, что начиная с этого выпуска проекты, созданные с помощью C#, по-прежнему нельзя экспортировать на мобильные и веб-платформы. Мы работаем над предоставлением поддержки как можно скорее, но устранение этого ограничения, вероятно, будет зависеть от выпуска .NET 8 в конце 2023 года. Это означает, что работа над включением мобильных и веб-платформ может по-настоящему начаться только позже в этом году.

#### GDExtension
Godot поставляется с уникальной технологией, позволяющей использовать языки низкого уровня, такие как C++, в качестве языка сценариев игр, без необходимости перекомпиляции движка.

Хотя технология все еще находится в стадии бета-тестирования для этого выпуска, GDExtension теперь еще ближе к GDScript и C# с точки зрения возможностей написания сценариев. Теперь вы можете внедрять новые узлы визуальных шейдеров и создавать плагины редактора с помощью GDExtension.

![[Godot gdextension-visual-shader-node.png|1000]]

Команда также внедрила систему обратной совместимости, чтобы гарантировать, что код, написанный для Godot 4.1, продолжит работать, даже если API изменится в будущих выпусках. Однако для устранения критических проблем в GDExtension в версии 4.1 потребовалось значительное нарушение совместимости, поэтому существующие расширения Godot 4.0 необходимо будет перенести и перекомпилировать для версии 4.1.  
  
Наконец, еще раз была проделана большая работа над архитектурой, чтобы сделать GDExtension API расширяемым в будущем.  
  
Все вышесказанное стало результатом совместной работы [Дэвида Снопека](https://github.com/dsnopek), [Хуана Линиецки](https://github.com/reduz), [РедворкДЕ](https://github.com/RedworkDE), [Юрия Рубинского](https://github.com/Chaosus) и [Юрия Сизова](https://github.com/YuriSizov).

### Editor
Godot 4 поддерживает несколько окон, которые мы используем для настройки проекта и редактора, а также различные всплывающие окна. Начиная с этой версии, теперь вы также можете отсоединять документы от плавающих окон и отсоединять редакторы сценариев, включая редактор шейдеров, и размещать их на отдельном мониторе.

![[Godot detached-code-editor.png|1000]]

В дополнение к этому редактор теперь будет отслеживать расположение вашего окна, так что при закрытии и повторном открытии редактора вы часто будете находиться именно там, где остановились.  
  
Вы можете поблагодарить за это [trollodel](https://github.com/trollodel), [Хендрика Брукера](https://github.com/Geometror) и [Томаша Шабору](https://github.com/KoBeWi).  
  
В Godot 4.0 была введена опция определения и экспорта типизированных массивов, а также экспорта отдельных узлов в инспектор, но объединить их было невозможно. Начиная с Godot 4.1, вы можете экспортировать массивы узлов в инспектор, что отлично подходит для связывания игровых объектов вместе.

![[Godot editor-exported-node-array.png|1000]]

Эта работа была выполнена Томашем и [Тимоти Бонхуром](https://github.com/ajreckof)
  
Менеджер проекта теперь позволяет назначать теги отдельным проектам и фильтровать проекты по тегам. Это значительно упрощает поиск по десяткам, если не сотням проектов Godot.

![[Godot editor-project-manager-tags 1.png|1000]]

### Rendering

Турбулентность частиц была переработана в этой версии на основе отзывов художников, чтобы обеспечить больший творческий контроль. Турбулентность широко используется для создания этих богатых эффектов растягивания, которые можно увидеть во многих современных играх. Большое спасибо KdotJPG и Raffaele Picca за этот вклад.

![[Godot render-particles-turbulence.png|1000]]

Используя новые 3D-текстуры шума, вы можете легко контролировать плотность объемного тумана и делать его тоньше в определенных областях. NoiseTexture3D также можно использовать для создания векторных полей аттракторов частиц, что полезно для имитации ветра, воздействующего на частицы. Ласуч и Клэй Джон реализовали эту функцию.

![[Godot render-3d-noise.png|1000]]

Хотя в рендерерах Godot все еще запланировано много улучшений, большинство из них будут присутствовать в будущих выпусках. Команда рендеринга (и все участники рендеринга) отдавала приоритет исправлению ошибок и стабильности, а не новым функциям. Примечательно, что рендеринг 3D GLES3 еще не завершен, но в ближайшие месяцы над ним будет проведена существенная работа.

### Navigation

Godot 4.0 представила функцию обхода в реальном времени для навигации искусственного интеллекта, но она была ограничена одной плоскостью.  
  
Эта версия включает полностью переписанные алгоритмы обхода от smix8, чтобы предоставить вам гораздо лучшее поведение и больший контроль. Уклонение теперь может происходить в 2D или 3D формате, позволяя летающим агентам перемещаться над теми, кто идет по земле.

![[navigation-3d-layers.png|1000]]

Вдобавок ко всему, теперь вы можете использовать слои для управления тем, какие агенты чего избегают, и назначать приоритеты, чтобы одни агенты отталкивали других.

![[navigation-priority.png|1000]]

Ознакомьтесь с [обновленной документацией](https://docs.godotengine.org/en/stable/tutorials/navigation/index.html), чтобы узнать больше о том, как работает улучшенная навигация.

### Platform support

Мы, как всегда, стремимся к тому, чтобы игры Godot были доступны на всех популярных платформах, и 4.1 по-прежнему предлагает те же возможности, что и Godot 4.0. Вы можете экспортировать на все настольные платформы как со стандартной, так и с .NET-версией движка, а также на мобильные устройства и в Интернет, если вы не используете C # в своих проектах.  
  
Начиная с версии 4.1 веб-экспорт все еще имеет некоторые ограничения из-за плохой поддержки поставщиками некоторых современных функций. Браузеры с плохой поддержкой WebGL 2, такие как Chrome на macOS, к сожалению, страдают от проблем, которые мы не можем устранить без исправления от Google или значительных усилий, затраченных на поддержку специального средства визуализации WebGL 1/GLES2.  
  
Мы также осознаем сложность настройки веб-игр на платформах хостинга, которые не позволяют вам устанавливать требуемые заголовки CORS для поддержки SharedArrayBuffer. В основном это зависит от того, что Safari реализует поддержку заголовков coep: без учетных данных, в то время как браузеры на базе Chromium и Firefox уже работают нормально (особенно если вы публикуете на itch.io). Существует возможный [обходной путь](https://github.com/godotengine/godot-proposals/issues/6616), который мы изучаем.

## Known issues

С каждым выпуском мы признаем, что будут проблемы, которые мы не смогли решить вовремя. Некоторые из этих проблем были выявлены, и в настоящее время ведется работа над исправлениями, в то время как другие остаются неизвестными до тех пор, пока кто-нибудь не столкнется с проблемой. Вы можете следить за нашим [багтрекером](https://github.com/godotengine/godot/issues), чтобы узнать, поступало ли сообщение о проблеме, с которой вы столкнулись. Мы ценим новые отчеты и подтверждения существующих отчетов, поскольку это помогает нам расставлять приоритеты при устранении конкретных проблем.  
  
Вот уже выявленные заметные проблемы, с которыми вы можете столкнуться в Godot 4.1:  
  
Недавно добавленный API для определения пользовательских свойств конфигурации для предустановок экспорта не сохраняет пользовательские конфигурации. Параметры конфигурации сбрасываются и теряются при перезапуске редактора. Исправление будет доступно в версии 4.1.1 
(см. [GH-79025](https://github.com/godotengine/godot/pull/79025)).

## On to the next release!
Мы уже начали работу над Godot 4.2, который выйдет через четыре месяца. 
Мы стремимся поддерживать темп и придерживаться этого надежного цикла выпуска, поэтому вам не придется долго ждать следующей серии улучшений и новых функций.  
  
А пока [наслаждайтесь Godot 4.1](https://godotengine.org/download/windows/)!