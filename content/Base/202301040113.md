Meta Quest Pro (часть 1) – Невероятно плохое прохождение AR
***
[[00 Meta Quest 2 Pro]]
***
# введение
Я фотографировал и снимал короткие видеоролики для демонстрации различных аспектов дисплеев и оптики Meta Quest Pro (MQP) уже более месяца. Это было что-то вроде чистки лука, когда обнаружение одной проблемы заставило меня провести эксперименты и сделать больше фотографий и видео, чтобы увидеть, что происходит.

Рискуя испортить изюминку, Meta Quest Pro невероятно плох для нашего времени с точки зрения визуальных факторов для бизнеса и рабочих приложений, которые, как утверждает Meta, устно и письменно, обслуживает MQP. В этой серии я попытаюсь дать количественную оценку многочисленным ошибкам с помощью изображений и измерений, применяя свой более чем 40-летний опыт работы с компьютерной графикой, дисплеями и визуальными интерфейсами для людей.

Интересно, кого, по их мнению, они обманывают, когда называют продукт, предназначенный для видеоигр, “деловым” или “корпоративным” продуктом. Мы видели это с Magic Leap, когда однажды они объявили Magic Leap 1 (см.: [Magic Leap плохо подходит для поворота на Enterprise – больше похоже на вращение повествования, чем на пивот](https://kguttag.com/2021/10/13/magic-leap-2-for-enterprise-really-plus-another-500m/)), а позже Magic Leap 2 (см.: [Magic Leap 2 для Enterprise, правда? Плюс еще 500 миллионов долларов](https://kguttag.com/2021/10/13/magic-leap-2-for-enterprise-really-plus-another-500m/)). Это похоже на то, как если бы кто-то из отдела маркетинга сказал: “По такой цене мы не можем продавать это как игровую систему, поэтому это должен быть бизнес-продукт”.

Несколько ютуберов-энтузиастов виртуальной реальности, которые восхищаются наличием нескольких мониторов с “большим экраном”, большинство из них указали на нелепость использования MPQ для бизнес-приложений. В будущих статьях этой серии будет показано, насколько плохи эти мониторы с очень низким разрешением с большими объемными пикселями, конфликтом вхождения, недопустимым мерцанием и не подходят для бизнес-приложений.

# Отправляемся на выставку CES 2023 и другие мероприятия по ведению домашнего хозяйства
Завтра я уезжаю в Лас-Вегас на выставку CES 2023 и почти полностью забронирован на первые три дня. Он еще не совсем вернулся к докомпандемическому уровню, но гораздо более оживленный, чем я ожидал. Так что, скорее всего, пройдет неделя или около того до следующей статьи из этой серии, и я буду смешивать статьи, освещающие то, что я вижу на выставке CES.

# Начиная с AR Passhrough
MQP настолько плох во многих отношениях для бизнес-приложений, что было трудно понять, с чего начать. Поскольку этот блог посвящен дополненной реальности, эта первая статья из серии статей посвящена вопросам прохождения AR/MR и, в частности, приведенному ниже заявлению [Meta Connect 2022: Meta Quest Pro, больше социальной виртуальной реальности и взгляд в будущее](https://about.fb.com/news/2022/10/meta-quest-pro-social-vr-connect-2022/):

Я не уверен, что Meta считает “бесшовным”, но я не думаю, что сквозная AR MQP приближается к словарному определению “отсутствие неудобных переходов, прерываний или признаков несоответствия”.

Многие обзоры уже субъективно прокомментировали низкое качество AR-passthrough Meta Quest Pro, и в этой статье мы попытаемся дать количественную оценку некоторым проблемам.

Я должен также добавить, что человеческое тело и зрительная система более искусны в том, чтобы смотреть на телефон сверху вниз, чем на плохо работающие экраны виртуальной реальности с низким разрешением.

# О фотографиях и видео
Все фотографии и видео были сняты через оптику Quest Pro и были сняты камерой Canon R5 8192 x 5464 пикселей с ~ 16-миллиметровым объективом с примерно 106 ° FOV по горизонтали на ~ 81 ° по вертикали. Это составляет около 80 пикселей на дюйм или ~ 4 пикселя камеры на пиксель мета-квеста (и, следовательно, выше Найквиста). Разрешающая способность Canon R5 с разрешением на 16 мм меньше близка к превосходному человеческому зрению. В большинстве случаев для обсуждения используются изображения в полном разрешении, но обрезанные, при этом также предоставляются целые изображения в полном разрешении. Вам нужно будет нажать даже на предоставленные обрезанные изображения, чтобы увидеть их в полном разрешении.

При съемке “через объектив” я всегда снимал левый глаз, так как так было легче подогнать камеру. Видеозапись левого глаза затем использовалась при любых сравнениях.

![[Meta Quest Pro.webp|500]]

Вы увидите (отвлекающий) diagonal screen door effect на всех снимках, сделанных с помощью MQP, который также виден невооруженным глазом. Как будет обсуждаться позже, дисплеи в MQP поворачиваются, и, таким образом, screen door effect поворачивается.  
  
Хотя камера может воспроизводить видео с разрешением 8K, видео были сняты в формате 4K (3860 x 2160), уменьшенном камерой с помощью датчика камеры с более высоким разрешением. Я обнаружил незначительные различия в видео 8K и 4K, поэтому я снимал в формате 4K со скоростью как 30, так и 60 кадров в секунду, в зависимости от ситуации. Видеофайлы MP4 включены (а не повторно сжаты для YouTube). Видеоклипы, как правило, короткие, и их можно воспроизвести, нажав на них. Я рекомендую включить просмотр с помощью плеера (в Google Chrome щелчок правой кнопкой мыши по видео включает зацикливание).

# Примечание о мерцании в видеороликах
На видео вы увидите мерцание и подвижные полосы яркости. Широко разрекламированное линейное затемнение не используется в текущих приложениях. Но текущие приложения MQP, выпущенные Meta, вместо этого организуют светодиоды в ряды, чтобы обеспечить непрерывное освещение с очень коротким рабочим циклом. Это приведет к появлению полос на неподвижных снимках и скручиванию видео (часть скручивания также вызвана вращающимся затвором камеры). Для фотоснимков я снимал с низкой (обычно 1/30 секунды или медленнее) выдержкой, чтобы усреднить эффект полосатости.  
  
Тем не менее, MQP имеет МНОГО мерцания. По какой–то странной причине приложение Meta Workplace снижает частоту затвора примерно до 70 Гц, что слишком медленно для устройства с широким полем зрения (периферийное зрение чувствительно к мерцанию), и в сочетании с циклом низкой нагрузки возникает много низкочастотных мерцаний, которые хорошо известны (по крайней мере, с 1980-х годов) вредно для людей. Большинство приложений используют частоту 90 Гц, что все еще немного медленно для широкого поля зрения, но лучше. В некоторых комнатах, в зависимости от освещения, я замечаю разницу в частоте биений между освещением комнаты и гарнитурой. Я планирую написать целую статью о проблеме мерцания MQP.
# Поворотные дисплеи MQP и цифровая коррекция искажений линз Pancake
...
# AR Проходит через Почти юридически Слепой и плохой цвет
...
# Расчет снизу вверх

Работая с разрешением “снизу вверх”, MQP имеет черно-белую камеру слежения с разрешением 1280x1024 пикселя на глаз, которая передискретизируется в процессе обрезки, поворота и бочкообразного искажения для создания изображения для отображения. Следует ожидать, что в результате процесса повторной выборки будут получены изображения размером около 500 x 500 пикселей или около 6 пикселей на градус для ~ 85 градусов на глаз. 106-градусное горизонтальное поле зрения MQP, обозначенное как “spec”, предназначено для обоих глаз.  
  
Ниже представлено 20-секундное видео в формате 4K, снятое через оптику для левого глаза с помощью камеры Canon R5 с 16-мм объективом, которая захватывает почти все поле зрения по горизонтали и около 75% вертикального поля зрения MQP. (Вам нужно будет щелкнуть правой кнопкой мыши и открыть в новом окне (или загрузить), чтобы увидеть его в полном разрешении, а также щелкнуть правой кнопкой мыши на видео, чтобы выбрать зацикливание). Цифровой счетчик на ПК обновляется только около 10 раз в секунду, чтобы обеспечить грубую синхронизацию между объективом и захватом видео (показано ниже). В отличие от этого, маятник с Микки, размахивающим маленькой диаграммой для глаз, дает постоянное аналоговое время.

# Очень низкий динамический диапазон и высокие искажения
*Динамический диапазон (от темного до светлого) при использовании passthrough MQP лучше всего можно описать как жалкий*. Использование камер слежения, чувствительных к ИК-излучению, означает, что все яркое или светоизлучающее излучает белый свет. Все, что плохо освещено, получается очень, очень шумным. Видео ниже иллюстрирует проблемы с динамическим диапазоном, а также экстремальные искажения и проблемы с цветом при прохождении AR. В то время как гораздо хуже с близкими объектами, странные искажения могут также возникать с предметами, находящимися дальше. *MQP переводит плохую передачу AR на новые низкие уровни*.

https://kguttag.com/wp-content/uploads/2022/12/2022-12-15-029298-0mm_f_th-ISO0.mp4

Следующий короткий видеоклип показывает просмотр бумажного документа (первая страница оригинального патента “sprite”) и другие проблемы, такие как перегоревшие дисплеи и подсветка. Изображение на компьютере доступно в разделе тестовые шаблоны KGOnTech.

https://kguttag.com/wp-content/uploads/2022/12/MQP-Lens-Passthrough-only-2022-12-12-029232-0mm_f_th-ISO0.mp4

# Частота кадров 30 Гц и запаздывание цветов

На видео ниже показан таймер на компьютере и движущийся Микки на маятнике, размахивающий миниатюрной диаграммой Снеллена. Таймер компьютера обновляется примерно 6,6 раза в секунду, а машущий Микки обеспечивает непрерывное аналоговое движение. Сочетание больших часов для приблизительной отметки времени и машущего Микки позволило мне синхронизировать съемку с помощью камеры с объективом и видеосъемку Meta с одним и тем же кадром. Машущий Микки также создает движущийся объект. ПК должен был быть настроен на почти минимальную яркость, чтобы он не задувал камеры MQP, чтобы я мог прочитать таймер.

https://kguttag.com/wp-content/uploads/2023/01/2022-12-18-029311-60FPS.mp4

https://kguttag.com/wp-content/uploads/2023/01/2022-12-90FPS-18T20-18-18.163Z.mp4

*Есть много прилагательных, которые я мог бы использовать для описания сквозного качества изображения MQP, но “бесшовный”, как описывает его Мета, не входит в их число*. Первое, на что следует обратить внимание, - это искажения, особенно вокруг диаграммы 'Маятник Микки' и 'машущий глаз'. Также можно видеть, что цвет очень приблизительный и отстает от движения.
  
В то время как цвета “видеозахвата” выглядят достаточно точными, цвета, снятые через объектив, перенасыщены (где это цвет). Этот перенасыщенный взгляд в сквозном режиме - это то, что видит и глаз. При использовании виртуальной реальности цвет выглядит достаточно точным (если он неуместен), поэтому вызывает некоторое недоумение, насколько плохо цвета выглядят в сквозном режиме (и, возможно, это можно исправить).  
  
Увеличенные стоп-кадры ниже сравнивают съемку через объектив с прямой видеосъемкой. Видеозапись была повернута и масштабирована для этого сравнения (в более поздних снимках она не будет поворачиваться). Обратите внимание, как совпадают недостающие пробелы в цвете и степень искажения на изображениях.

# Различные частоты кадров не синхронизированы

Хотя частота кадров на дисплее составляла около 90 Гц, а частота захвата видео с помощью приложения Meta Developer также составляла около 90 Гц, частоты немного отличаются, что приводит к разрывам/перекатам где-то при захвате примерно на каждом 3-м кадре.

![[MQP-frame-roll.webp|250]]

Помимо этого, видео, снятое с Tears/frame-roll кадров видеозахвата, не видно на видео через оптику. Кадр, снятый выше, позволяет избежать этих разрывов кадров. Обрезанный кадр (справа) показывает один из этих разрывов. Это говорит о том, что захват видео не происходит синхронно с источником видео, поступающим на дисплеи. Видео также снимается с более высокой частотой кадров, чем при захвате видео, поскольку в захвате видео присутствуют повторяющиеся кадры.
# Захваченный видеопоток - это НЕ то, что отправляется на дисплей
Первоначально я предполагал, что захваченный MQDH - это то, что было отправлено на дисплей, но это не так. Захваченное видео имело частоту 90 Гц (нижний ряд ниже), но кадры захвата меняются примерно на частоте 30 Гц с двумя повторяющимися кадрами и с одним из кадров, имеющим перекладину. Но на видео с частотой 60 Гц, снятом через оптику (верхний ряд ниже), каждый кадр уникален (и, следовательно, отличается от снимка), но весь объект движется только с частотой 30 Гц. Поскольку камера работала на частоте ~ 60 Гц, а захват MQDH был на частоте ~ 90 Гц, на три кадра захвата приходится примерно два кадра камеры. На изображении ниже показаны посевы с красными линиями на делениях 30 Гц.

![[MQP-Through-Lens-Versus-video-feed-timing-002.webp|1000]]

Если вы внимательно посмотрите на последовательность кадров в объективе, вы должны заметить, что в каждой паре кадров, разделенных красными линиями, объект/Микки НЕ двигается. Скорее всего, цвет перемещается, а движущийся контент искажается по-разному. Первый кадр в паре точно соответствует одному из кадров в MQDH-захвате, но второй кадр уникален. У меня нет доступной камеры с частотой кадров 90 Гц, но я подозреваю, что изображение меняется на частоте 90 Гц, когда дисплей работает на частоте 90 Гц, а камера с частотой 60 Гц получает два из трех промежуточных кадров.

# Задержка движения фотона
Я видел комментарии рецензентов о том, что видеопоток, который они снимают, объединяющий оба глаза, выглядит лучше, чем то, что они видят своими глазами. К сожалению, из-за сбоев в программном обеспечении и бесполезных сообщений об ошибках в приложении MQDH я не мог снимать видео более высокого качества с помощью MQDH (только запись и воспроизведение с гарнитуры с более низким разрешением 30 кадров в секунду).  
  
Похоже, что то, что запечатлено, отличается и лучше, чем то, что показано. Я подозреваю, что при обработке того, что отправляется на глазные дисплеи, приоритет отдается задержке "движения фотона", а не абсолютному качеству. Они хотят как можно быстрее донести новую информацию до глаз, в то время как при видеосъемке качество изображения может быть важнее задержки.  
  
Я также провел небольшой эксперимент, в ходе которого я включил вспышку камеры в тускло освещенной комнате и измерил задержку с помощью датчиков освещенности, используя один датчик для запуска захвата осциллографа, а второй датчик освещенности для захвата реакции дисплея. Обычно для появления вспышки на изображении требовалось чуть более четырех кадров частотой 90 Гц (~ 40-50 мс). На приведенном ниже снимке области видимости вы можете заметить, что отклик (выделен желтым цветом) представляет собой три несколько ступенчатых импульса с низким рабочим циклом. Светодиоды подсветки MQP загораются только в течение очень короткого периода времени. Различные ряды светодиодов загораются в скользящей последовательности и, таким образом, образуют рисунок ступеней лестницы. В будущих статьях я планирую более подробно остановиться на светодиодной подсветке MQP. В соответствии с видеозаписями вспышка отображается для трех кадров с частотой 90 Гц или 30 Гц.

![[MQP-Motion-to-Photon-waveform-002.webp|500]]

Метод в Безумии смешивания ИК-трекинга с цветной камерой
# Научный проект пошел не так или маркетинговое решение?
Моей первой реакцией было то, что сквозное прохождение MQP изначально предназначалось для того, чтобы дать игрокам лучший способ, чем Meta Quest 2, видеть свое окружение при определении границ. Но затем сильные мира сего в Meta сказали, что им нужно, чтобы это было устройство “Смешанной реальности”. В то же время реализация предполагает, что это был “эксперимент, который ускользнул из лаборатории”. Возможно, ответ заключается в том, что переход MQP - это и то, и другое, поскольку исследователи хотят продемонстрировать и поэкспериментировать в более широком масштабе с технологией, и желание компании продавать продукт как более смешанный. Реальность, а не просто виртуальная реальность.

# Сквозной переход цвета, вдохновленный Рубом Гольбергом
Meta Quest Pro AR passhrough, похоже, вдохновлен [Рубом Голдбергом](https://en.wikipedia.org/wiki/Rube_Goldberg_machine) (или Хитом Робинсоном для моих британских друзей), известным своими карикатурами на чрезмерно сложные машины.  
  
Согласно SadlyInReality (Sadlyitsbradley's written articles), AR-переход Quest Pro использует две камеры слежения / SLAM с низким разрешением (номинальное разрешение 1280 × 1024) для передачи информации о яркости для каждого дисплея глаза в сочетании с одной 16-мегапиксельной цветной камерой для раскрашивания каждого изображения. А разрешение 1280 × 1024 не считалось, как утверждает Meta, “камерами высокого разрешения” уже около 30 лет. Камеры слежения, но верхняя граница разрешения. Как будет видно, фактическое разрешение намного хуже.

# Метод в безумии: MQP отдает предпочтение трехмерному пространству над качеством изображения
Инженеры Meta должны были знать, что объединение одной цветной камеры с двумя оптимизированными для отслеживания камерами серьезно ухудшит качество изображения. Как я часто говорю, *“когда умные люди делают что-то, что кажется глупым, это потому, что они пытались избежать чего-то, что, по их мнению, было хуже”*. В этом случае они были готовы пожертвовать качеством изображения, чтобы попытаться привести положение вещей в реальном мире в соответствие с тем, где появляются виртуальные объекты. В какой-то степени они достигли этой цели. Но качество изображения и уровень искажений, особенно “близких предметов”, к которым относятся руки пользователя, настолько плохи, что это кажется пирровой победой.

[Брэдли сообщает, что Meta Quest 3](https://youtu.be/tq57TPTsBQQ) будет иметь две цветные камеры с высоким разрешением, по одной на глаз, вместо того, чтобы использовать одну цветную камеру, как MQP. Это должно обеспечить лучшее качество изображения и уменьшить некоторые проблемы. Однако, вероятно, по-прежнему будут наблюдаться эффекты искажения, поскольку они пытаются отобразить изображения с реальных камер на основе информации камеры слежения и определения глубины в режиме реального времени. Кроме того, по словам Брэда, *процесс AR passhrough требует очень больших затрат процессора, а потребляемая мощность резко возрастает*. Это заставляет задуматься, сколько потребуется обработки, чтобы получить приличное качество изображения.

# Проблемы с Passthrough AR (независимо от MQP)
В июне 2022 года мы с Брэдом сняли [28-минутное видео](https://youtu.be/lvJ1WmWYCdE) с YouTube-канала SadlyIsBradley, в котором обсуждали общие плюсы и (в основном) минусы сквозной AR (виртуальной реальности с камерами). На слайде ниже описаны многие моменты, описанные в видео. Вместо того чтобы перефразировать эти моменты, я отсылаю вас к этому видео.

![[2022-06-AWE-Slides-AR-Passthrough-Pro-and-Cons.webp|500]]

# Это может быть опасно — “Виртуальная реальность для скорой помощи”
Важный момент, отсутствующий выше, но обсуждаемый в видео, заключается в том, что *Passthrough AR часто может быть небезопасным* из-за различных способов, которыми оно может скрывать реальные опасности, от столкновения с предметами до столкновения с оборудованием и транспортными средствами. Брэд сказал мне, что в сообществе виртуальной реальности это известно как “VR to the ER”.

Сквозной режим MQP устраняет только некоторые проблемы визуальной безопасности виртуальной реальности, и ниже приведены некоторые из оставшихся проблем:

- Гарнитура по-прежнему блокирует значительную часть зрения человека
- Виртуальный контент полностью блокирует реальный мир
- Динамический диапазон настолько мал, что ярко освещенные предметы в реальном мире полностью затухают (становятся белыми) и, таким образом, полностью затемняются
- Разрешение в реальном мире очень низкое (что является основной темой этой статьи).  
- Passthrough видео может быть сильно искажено

Юристы Meta знают о проблемах “VR to the ER”, поскольку устройство сообщает вам, что вы должны находиться в помещении в одной комнате, без препятствий, и провести электронную границу. Но на самом деле, если вы проведете границу достаточно маленькой, чтобы защитить себя, вас будут постоянно раздражать визуальные предупреждения о границах. Использование устройства без постоянного раздражения, полное опустошение вашей комнаты и заполнение всего требует физического риска. И все же вы будете пойманы в ловушку, когда быстро потянетесь к чему-то в виртуальном мире и наткнетесь на что-то в реальном мире. *Я вижу, как специалисты по корпоративной безопасности сейчас разрабатывают требования😁*.

И это лишь некоторые из очевидных проблем безопасности. Существуют также проблемы безопасности из—за человеческого фактора, которые, вероятно, вызовут проблемы при длительном “воздействии” продукта, в том числе конфликт адаптации к вергенции (который Magic Leap 1 пытался решить, а затем отказался в Magic Leap 2), мерцание (которое, похоже, никого не волнует - подробнее в следующей статье).

# Вывод – Далеко не готов к прайм–тайму - Почему?
Сквозной режим MQP, хотя и является большим улучшением по сравнению с Meta Quest 2, даже близко не подходит для использования в качестве устройства AR/MR. У меня есть свои проблемы с AR-проходом Lynx, но это далеко не крушение поезда MQP. Сквозной режим едва подходит для поиска больших объектов в реальном мире и настройки границ для приложений виртуальной реальности.  
  
Он настолько плох в передаче AR, что заставляет меня задуматься, почему Meta заявила, что это устройство смешанной реальности. Некоторые предположили, что это было сделано для того, чтобы заявить о MR-устройстве раньше ожидаемой гарнитуры Apple MR.  
  
Даже если Meta значительно улучшит качество изображения в сквозных режимах, сомнительно, что она приблизится к безопасности в использовании без типичных ограничений виртуальной реальности (в закрытом помещении в безопасной комнате с небольшим количеством/без препятствий). Компания Meta потратила в этой области более 30 миллиардов долларов, и MQP - это то, что они могут сделать за “профессиональное” устройство стоимостью 1500 долларов.  
  
Есть так много вещей, которые Meta Quest Pro делает неправильно с точки зрения визуальных факторов человека. Они даже неправильно понимают такие простые вещи, как мерцание. Не говоря уже о трудноразрешимых проблемах, таких как отсутствие решения [vergence accommodation conflict (VAC)](https://kguttag.com/2021/12/06/meta-aka-facebook-cambria-electrically-controllable-lc-lens-for-vac/).
  
Во всяком случае, MQP усиливает многие недостатки сквозной AR, которые я сделал в видео с SadlyItsBradley.